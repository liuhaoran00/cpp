# CI/CD 持续集成说明

## 概述

LinkerHand SDK 的 CI 流程设计为**轻量级编译验证**，专注于：

1. **Linux 编译验证** - 确保代码在 Linux 上正确编译
2. **静态代码分析** - 检查代码质量和潜在问题

**用户功能测试**需要连接实际硬件，请使用 `linker_hand_user_test` 工具。

---

## CI 工作流

### 触发条件

- `push` 到 `main`、`master`、`develop` 分支
- `pull_request` 到这些分支
- 仅当 `linker_hand/` 目录有变更时触发

### 构建任务

| 任务 | 平台 | 说明 |
|------|------|------|
| `build-linux` | Ubuntu 22.04 / 24.04 | GCC 编译验证 |
| `static-analysis` | Ubuntu 22.04 | cppcheck 静态分析 |

### 构建产物

CI 会生成并上传以下构建产物：

- **Linux**: `linker_hand_user_test`, `linker_hand_example`, `*.so`

---

## 用户测试工具

### 功能说明

`linker_hand_user_test` 是面向最终用户的硬件功能验证工具：

| 测试模块 | 描述 |
|----------|------|
| 环境检测 | 检查 CAN 接口 |
| 硬件连接 | 检测灵巧手设备，读取固件版本 |
| 基本功能 | 关节位置读取、速度读取 |
| 运动测试 | 小幅度安全运动验证 |
| 传感器测试 | 压力、温度、电流传感器 |

### 使用方法

```bash
# 默认测试 (L10 右手)
./linker_hand_user_test

# 指定型号和手部
./linker_hand_user_test --model L25 --hand left
./linker_hand_user_test --model L7 --hand right

# 查看帮助
./linker_hand_user_test --help
```

### 支持的型号

| 参数 | 型号 | 关节数 |
|------|------|--------|
| `O6` | O6 | 6 |
| `L6` | L6 | 6 |
| `L7` | L7 | 7 |
| `L10` | L10 | 10 |
| `L20` | L20 | 20 |
| `L21` | L21 | 25 |
| `L25` | L25 | 25 |

### 测试输出示例

```
═══════════════════════════════════════════════════════════════
              LinkerHand SDK 用户测试工具 v1.0
═══════════════════════════════════════════════════════════════

测试配置:
  ├── 型号: L10
  ├── 手部: 右手 (Right)
  └── 关节数: 10

[1/5] 环境检测 (Environment Check)
  ├── 系统: Linux/Ubuntu
  ├── CAN 接口检测: ✓ 通过 CAN 接口: can0 ✓  can1 ✗
  └── 权限检查: ✓ 通过

[2/5] 硬件连接测试 (Hardware Connection)
  ├── 正在连接灵巧手...
  ├── 设备连接: ✓ 通过
  ├── 型号: L10
  ├── 手部: 右手 (Right)
  └── 固件版本: 7.0.0.0

[3/5] 基本功能测试 (Basic Function)
  ├── 关节位置读取: ✓ 通过 [155, 162, 176, 125, 255, 255, 180, 179, 181, 68]
  └── 速度读取: ✓ 通过 [100, 100, 100, 100, 100]

[4/5] 运动测试 (Motion Test)
  ├── 即将进行小幅度运动测试，请确保灵巧手周围无障碍物
  ├── 拇指微动测试: ✓ 通过 运动响应正常
  └── 速度设置测试: ✓ 通过

[5/5] 传感器测试 (Sensor Test)
  ├── 压力传感器: ✓ 通过 5 组, 共 360 个数据点
  ├── 温度传感器: ✓ 通过 平均温度 45°C
  └── 电流传感器: ✓ 通过 [50, 48, 52, 49, 51]

═══════════════════════════════════════════════════════════════
                        测试摘要
═══════════════════════════════════════════════════════════════
  总测试项: 9
  通过: 9  ✓
  失败: 0

  状态: 全部通过 ✓
═══════════════════════════════════════════════════════════════
```

---

## 本地编译

### Linux (Ubuntu)

```bash
cd linker_hand
mkdir build && cd build
cmake .. -DBUILD_USER_TEST=ON
make -j$(nproc)

# 运行用户测试
./linker_hand_user_test --model L10 --hand right
```

---

## 故障排除

### Linux: CAN 接口未找到

```bash
# 检查 CAN 接口
ip link show can0

# 启用 CAN 接口
sudo ip link set can0 up type can bitrate 1000000
```

### 设备连接失败

1. 检查灵巧手电源是否开启
2. 检查 CAN 线缆连接
3. 确认型号 (`--model`) 和手部类型 (`--hand`) 正确
